<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Расписание МИРЭА (API)</title>
    <style>
        /* --- СТИЛИ (iOS Like) --- */
        :root {
            --bg-page: #F2F2F7;
            --text-main: #1C1C1E;
            --text-muted: #8E8E93;
            --mirea-blue: #0D3C61;
            --mirea-cyan: #00B4D8;
            --lec-bg: #E3F2FD; --lec-text: #1565C0;
            --prac-bg: #E8F5E9; --prac-text: #2E7D32;
            --lab-bg: #FFF3E0; --lab-text: #EF6C00;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; background: var(--bg-page); color: var(--text-main); padding-bottom: 80px; }

        .header {
            background: linear-gradient(135deg, #0D3C61 0%, #00B4D8 100%); color: white;
            padding: 2.5rem 1rem 2rem; text-align: center; border-radius: 0 0 24px 24px;
            margin-bottom: 1.5rem; box-shadow: 0 4px 20px rgba(0, 180, 216, 0.2);
        }
        .group-title { font-size: 2rem; font-weight: 800; line-height: 1.1; margin-bottom: 5px; }
        .group-desc { font-size: 0.8rem; opacity: 0.9; }

        /* --- UI CONTROLS --- */
        .controls-container { max-width: 600px; margin: 0 auto 1.5rem; padding: 0 1rem; }
        .control-section { margin-bottom: 16px; }
        .control-label { font-size: 0.75rem; font-weight: 700; color: var(--text-muted); text-transform: uppercase; margin-bottom: 6px; margin-left: 6px; }
        .control-group { background: white; border-radius: 14px; padding: 4px; display: flex; box-shadow: 0 2px 8px rgba(0,0,0,0.04); }
        
        .toggle-btn {
            flex: 1; border: none; background: transparent; padding: 10px 0;
            font-size: 0.95rem; font-weight: 600; color: var(--text-muted);
            border-radius: 10px; cursor: pointer; transition: all 0.2s ease;
        }
        .toggle-btn.active { background: var(--text-main); color: white; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }

        /* --- РАСПИСАНИЕ --- */
        .schedule-container { max-width: 600px; margin: 0 auto; padding: 0 1rem; min-height: 200px; }
        .loading-state { text-align: center; padding: 40px; color: var(--text-muted); font-weight: 500; }
        .error-state { text-align: center; padding: 20px; color: #D32F2F; background: #FFEBEE; border-radius: 12px; margin: 20px; }

        /* Карточка дня */
        .day-card { margin-bottom: 1.5rem; animation: fadeIn 0.3s ease-out; }
        .day-header { font-size: 1.1rem; font-weight: 800; margin-bottom: 0.8rem; padding-left: 4px; color: var(--text-muted); text-transform: uppercase; }
        
        /* Пара */
        .pair-item {
            background: white; border-radius: 16px; padding: 1rem; margin-bottom: 0.8rem;
            display: flex; gap: 1rem; box-shadow: 0 2px 5px rgba(0,0,0,0.03);
            border-left: 4px solid transparent; /* Цветной индикатор */
        }
        
        /* Цвета индикаторов */
        .type-lk { border-left-color: var(--lec-text); }
        .type-pr { border-left-color: var(--prac-text); }
        .type-lab { border-left-color: var(--lab-text); }

        .pair-time { min-width: 55px; border-right: 1px solid #F0F0F0; padding-right: 10px; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .pair-time .num { font-size: 1.4rem; font-weight: 800; color: var(--mirea-blue); margin-bottom: 4px; line-height: 1; }
        .pair-time .interval { font-size: 0.65rem; color: var(--text-muted); display: flex; flex-direction: column; align-items: center; line-height: 1; font-weight: 500; }
        
        .pair-content { flex: 1; display: flex; flex-direction: column; justify-content: center; }
        .subject { font-weight: 700; font-size: 0.95rem; line-height: 1.3; color: var(--text-main); margin-bottom: 4px; }
        .teacher { font-size: 0.8rem; color: var(--text-muted); }
        
        .badge { display: inline-block; font-size: 0.65rem; font-weight: 700; text-transform: uppercase; padding: 3px 8px; border-radius: 6px; margin-top: 6px; align-self: flex-start; }
        .type-lk .badge { background: var(--lec-bg); color: var(--lec-text); }
        .type-pr .badge { background: var(--prac-bg); color: var(--prac-text); }
        .type-lab .badge { background: var(--lab-bg); color: var(--lab-text); }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

    <header class="header">
        <div class="group-title" id="title">ПКБО-01-24</div>
        <div class="group-desc">Проектирование и технологии СВЧ устройств</div>
    </header>

    <div class="controls-container">
        <!-- Недели -->
        <div class="control-section">
            <div class="control-label">Учебная неделя</div>
            <div class="control-group">
                <button class="toggle-btn active" onclick="setWeek(1)" id="w1">1</button>
                <button class="toggle-btn" onclick="setWeek(2)" id="w2">2</button>
                <button class="toggle-btn" onclick="setWeek(3)" id="w3">3</button>
                <button class="toggle-btn" onclick="setWeek(4)" id="w4">4</button>
            </div>
        </div>
        <!-- Подгруппы -->
        <div class="control-section">
            <div class="control-label">Подгруппа</div>
            <div class="control-group">
                <button class="toggle-btn active" onclick="setGroup(1)" id="g1">1 подгруппа</button>
                <button class="toggle-btn" onclick="setGroup(2)" id="g2">2 подгруппа</button>
            </div>
        </div>
    </div>

    <div class="schedule-container" id="schedule-root">
        <div class="loading-state">Загрузка расписания...</div>
    </div>

    <script>
        // === КОНФИГУРАЦИЯ ===
        const GROUP_ID = '1_4896'; // ID твоей группы
        const API_URL = `https://schedule-of.mirea.ru/schedule/api/search?match=${GROUP_ID}`;
        
        // Время пар (стандарт МИРЭА)
        const TIME_MAP = {
            1: ["09:00", "10:30"], 2: ["10:40", "12:10"], 3: ["12:40", "14:10"],
            4: ["14:20", "15:50"], 5: ["16:20", "17:50"], 6: ["18:00", "19:30"], 7: ["19:40", "21:10"]
        };

        const DAYS = ["", "Понедельник", "Вторник", "Среда", "Четверг", "Пятница", "Суббота"];
        
        // Состояние приложения
        let scheduleCache = null; // Данные от API
        let state = {
            week: 1,
            group: 1
        };

        async function loadSchedule() {
            try {
                // 1. Идем в API
                const response = await fetch(API_URL);
                if (!response.ok) throw new Error('Ошибка сети');
                const json = await response.json();

                if (json.data.length === 0) throw new Error('Группа не найдена');
                
                // 2. Сохраняем данные
                scheduleCache = json.data[0].schedule; 
                
                // 3. Рендерим
                render();

            } catch (err) {
                document.getElementById('scheduleRoot').innerHTML = `
                    <div class="error-state">
                        <strong>Ошибка загрузки</strong><br>
                        ${err.message}<br><br>
                        <button onclick="location.reload()" style="padding:8px 16px; border:none; background:#D32F2F; color:white; border-radius:8px; cursor:pointer;">Повторить</button>
                    </div>`;
                console.error(err);
            }
        }

        function render() {
            const container = document.getElementById('scheduleRoot');
            container.innerHTML = '';
            
            if (!scheduleCache) return;

            // Проходим по дням недели (1..6)
            let hasLessons = false;
            
            for (let dayNum = 1; dayNum <= 6; dayNum++) {
                const dayLessons = scheduleCache[dayNum.toString()]; // "1", "2"...
                if (!dayLessons) continue;

                // Собираем HTML для пар этого дня
                let dayHtml = '';
                let dayHasLessons = false;

                // Сортируем пары (API возвращает объект, где ключ - номер пары)
                const sortedPairs = Object.keys(dayLessons).sort((a,b) => parseInt(a) - parseInt(b));

                sortedPairs.forEach(pairNum => {
                    const lessonsList = dayLessons[pairNum];
                    
                    lessonsList.forEach(lesson => {
                        // 1. Фильтр по неделе
                        if (!lesson.weeks.includes(state.week)) return;

                        // 2. Фильтр по подгруппе
                        // lesson.num_group: 0 (общая), 1, 2...
                        // Если у урока указана подгруппа и она не совпадает с выбранной -> пропускаем
                        // НО: Если урок общий (0), показываем всем
                        // В API schedule-of поле может называться num_group или быть в названии
                        // В текущем API поле num_group отсутствует в явном виде в поиске?
                        // Проверим структуру. Обычно там массив weeks.
                        
                        // !!! Важно: В поиске schedule-of часто не отдают num_group явно. 
                        // Но если отдают, то фильтруем. Если нет - показываем всё.
                        // Доп проверка по названию "(1 п/г)"
                        
                        let lessonSubgroup = 0;
                        if (lesson.name.match(/1\s*п\/г|подгруппа\s*1/i)) lessonSubgroup = 1;
                        if (lesson.name.match(/2\s*п\/г|подгруппа\s*2/i)) lessonSubgroup = 2;

                        if (lessonSubgroup !== 0 && lessonSubgroup !== state.group) return;


                        // Тип пары и стили
                        let typeClass = "type-pr";
                        let typeName = lesson.type;
                        if (typeName.includes("Лек")) typeClass = "type-lk";
                        if (typeName.includes("Лаб")) typeClass = "type-lab";
                        if (typeName.includes("Прак")) typeClass = "type-pr";

                        // Время
                        const time = TIME_MAP[pairNum] || ["--:--", "--:--"];

                        dayHtml += `
                        <div class="pair-item ${typeClass}">
                            <div class="pair-time">
                                <div class="num">${pairNum}</div>
                                <div class="interval"><span>${time[0]}</span><span>${time[1]}</span></div>
                            </div>
                            <div class="pair-content">
                                <div class="subject">${lesson.name}</div>
                                <div class="teacher">${lesson.teacher || "Кафедра"}</div>
                                <span class="badge">${typeName}</span>
                            </div>
                        </div>`;
                        dayHasLessons = true;
                    });
                });

                if (dayHasLessons) {
                    hasLessons = true;
                    container.innerHTML += `
                    <div class="day-card">
                        <div class="day-header">${DAYS[dayNum]}</div>
                        ${dayHtml}
                    </div>`;
                }
            }

            if (!hasLessons) {
                container.innerHTML = '<div class="loading-state">Занятий нет</div>';
            }
        }

        // === УПРАВЛЕНИЕ ===
        window.setWeek = (w) => {
            state.week = w;
            updateUI();
            render();
        }

        window.setGroup = (g) => {
            state.group = g;
            updateUI();
            render();
        }

        function updateUI() {
            // Кнопки недель
            for(let i=1; i<=4; i++) {
                document.getElementById(`w${i}`).className = `toggle-btn ${state.week === i ? 'active' : ''}`;
            }
            // Кнопки групп
            document.getElementById('g1').className = `toggle-btn ${state.group === 1 ? 'active' : ''}`;
            document.getElementById('g2').className = `toggle-btn ${state.group === 2 ? 'active' : ''}`;
        }

        // Запуск
        loadSchedule();

    </script>
</body>
</html>
